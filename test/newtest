#!/bin/bash

tname="${1// /_}"

confirmed=0

while [ "${confirmed}" -eq 0 ]; do
    read -e -p "Describe your new test briefly: " -i "${tname}" TEST_NAME
    tname="${TEST_NAME// /_}"

    declare -i newnum=0
    while [ -d tests/$(printf "%02d_*" "${newnum}") ]; do
	newnum=$((newnum + 1))
    done
    newname="$(printf "%02d_%s" "${newnum}" "${tname}")"

    read -p "Your new test will be named tests/$newname. OK? [Y/n]"
    if [ -z "${REPLY}" ] || [ "${REPLY,}" == "y" ]; then
        confirmed=1
    fi
done

cp -a tests/00_basic "tests/${newname}"
# derive script name, the actual script will be generated by make
newscript="test-${newname}.bash"

echo "You can now edit ${newname}."
echo "Run the test with TESTS=\"${newscript}\" make -e check."
echo "When ready, add ${newscript} to test_scripts in Makefile.am."
