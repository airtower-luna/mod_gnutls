Define	OCSP_PORT	${OCSP_PORT}
Define	TEST_PORT	${OCSP_PORT}

Include ${srcdir}/base_apache.conf

Include		${srcdir}/cgi_module.conf
LoadModule	env_module		${AP_LIBEXECDIR}/mod_env.so
LoadModule	rewrite_module		${AP_LIBEXECDIR}/mod_rewrite.so

# separate log and PID file
CustomLog	logs/${TEST_NAME}.ocsp.access.log combined
ErrorLog	logs/${TEST_NAME}.ocsp.error.log
PidFile		ocsp@PID_AFFIX@.pid

<IfDefine !OCSP_INDEX>
	# Default index file, define OCSP_INDEX in the test specific
	# config to override
	Define	OCSP_INDEX	${PWD}/authority/ocsp_index.txt
</IfDefine>

<VirtualHost _default_:${OCSP_PORT}>
	RewriteEngine	On
	RewriteRule	^/ocsp(.*)	/ocsp.cgi$1	[L]
	<Location /ocsp/>
		# Some clients seem to have trouble with chunked
		# encoding, so force HTTP/1.0 for now.
		SetEnv	downgrade-1.0
		# certificates and key for ocsp.cgi
		SetEnv	CA_CERT		${PWD}/authority/x509.pem
		SetEnv	OCSP_INDEX	${OCSP_INDEX}
		SetEnv	OCSP_CERT	${PWD}/authority/ocsp-responder/x509.pem
		SetEnv	OCSP_KEY	${PWD}/authority/ocsp-responder/secret.key
		<If "-n osenv('OPENSSL')">
			# Pass OPENSSL variable to CGI script if set
			SetEnv	OPENSSL		${OPENSSL}
		</If>
	</Location>
	<Directory ${srcdir}/data>
		Options	+ExecCGI
	</Directory>
</VirtualHost>
