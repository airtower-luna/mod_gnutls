<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <title>mod_gnutls Manual 0.1</title>
        <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
        <style type="text/css" media="all">
        h1{text-align:center;}
        p{margin-left:2%;}
        code{color:#000000;background-color:cyan;}
        h4{text-align:center;color:#000000;background-color:cyan;width:100%;}
        .directive{margin-left:5%;margin-right:5%;border:#000000 solid 1px;}
        h5{display:inline;margin-right:10%;}
        .warn{color:inherit;background-color:#FF0000}
        h6{margin-left:2%;font-weight:bold;display:inline;}
        </style>
    </head>
    <body>
        <h1>mod_gnutls Manual 0.1<br /><small>July 2011</small></h1>
        <hr />
        <div id="Contents">
            <h2>Contents</h2>
            <ol>
                <li>Compilation & Installation</li>
                <li>Integration</li>
                <li>Configuration Directives<br />
                    <ul>
                        <li>GnuTLSCache</li>
                        <li>GnuTLSCacheTimeout</li>
                        <li>GnuTLSSessionTickets</li>
                        <li>GnuTLSCertificateFile</li>
                        <li>GnuTLSKeyFile</li>
                        <li>GnuTLSPGPCertificateFile</li>
                        <li>GnuTLSPGPKeyFile</li>
                        <li>GnuTLSClientVerify</li>
                        <li>GnuTLSClientCAFile</li>
                        <li>GnuTLSPGPKeyringFile</li>
                        <li>GnuTLSEnable</li>
                        <li>GnuTLSDHFile</li>
                        <li>GnuTLSRSAFile</li>
                        <li>GnuTLSSRPPasswdFile</li>
                        <li>GnuTLSSRPPasswdConfFile</li>
                        <li>GnuTLSPriorities</li>
                        <li>GnuTLSExportCertificates</li>
                    </ul>
                </li>
                <li>Configuration Examples<br />
                    <ul>
                        <li>Simple Standard SSL Example</li>
                        <li>Server Name Indication Example</li>
                    </ul>
                </li>
                <li>Performance Issues</li>
                <li>Environment Variables</li>
                <li>Credits</li>
            </ol>
        </div>
        <hr />
        <div id="Installation">
            <h2>Compilation &amp; Installation</h2>
            <p>mod_gnutls uses the "configure/make/make install" mechanism common to many Open Source programs.<br />
            Most of the dirty work is handled by either configure or Apache's apxs utility.<br />
            If you have built Apache modules before, there shouldn't be any surprises for you.<br />
            The interesting options you can pass to configure are:<br />
            <br />
            --with-apxs=PATH<br />
            This option is used to specify the location of the apxs utility that was installed as part of apache.<br />
            Specify the location of the binary, not the directory it is located in.<br />
            <br />
            --with-libgnutls=PATH<br />
            Full path to the libgnutls-config program.<br />
            <br />
            --with-apr-memcache=PREFIX<br />
            Prefix to where apr_memcache is installed.<br />
            <br />
            --help<br />
            Provides a list of all available configure options.</p>
        </div>
        <hr />
        <div id="Integration">
            <h2>Integration</h2>
            <p>To activate mod_gnutls just add the following line to your httpd.conf and restart Apache:</p>
            <p><code>LoadModule gnutls_module modules/mod_gnutls.so</code></p>
        </div>
        <hr />
        <div id="Configuration">
            <h2>Configuration Directives:</h2>
            <h4>GnuTLSCache</h4>
            <div class="directive">
                <h5>Description:</h5>Configure SSL Session Cache<br />
                <h5>Syntax:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                GnuTLSCache [<i>dbm</i>|<i>gdbm</i>|<i>memcache</i>|<i>none</i>] [path|server list|-]<br />
                <h5>Default:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                GnuTLSCache gdbm "conf/gnutls_cache"<br />
                <h5>Context:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                global config<br />
            </div>
            <p>This directive configures the SSL Session Cache for mod_gnutls.<br />
               This could be shared between machines of different architectures.</p>
            <p>
               <b>dbm (Requires Berkeley DBM)</b><br />
               Uses the default Berkeley DB backend of APR DBM to cache SSL Sessions results.<br />
               The argument is a relative or absolute path to be used as the DBM Cache file.<br />
               This is compatible with most operating systems, but needs the Apache Runtime to be compiled with Berkeley DBM support.<br />
               <b>gdbm</b><br />
               Uses the GDBM backend of APR DBM to cache SSL Sessions results.<br />
               The argument is a relative or absolute path to be used as the DBM Cache file.<br />
               This is the default and recommended option.<br />
               <b>memcache</b><br />
               Uses a memcached server to cache the SSL Session.<br />
               The argument is a space separated list of servers. If no port number is supplied, the default of 11211 is used.<br />
               This can be used to share a session cache between all servers in a cluster.<br />
               <b>none</b><br />
               Turns off all caching of SSL Sessions.<br />
               This can significantly reduce the performance of mod_gnutls since even followup connections by a client must renegotiate parameters instead of reusing old ones.<br />
            </p>
            <h4>GnuTLSCacheTimeout</h4>
            <div class="directive">
                <h5>Description:</h5>Timeout for SSL Session Cache expiration<br />
                <h5>Syntax:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                GnuTLSCacheTimeout <i>seconds</i><br />
                <h5>Default:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                GnuTLSCacheTimeout 300<br />
                <h5>Context:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                global config<br />
            </div>    
            <p>Sets the timeout for SSL Session Cache entries expiration.<br />
            This directive is valid even if Session Tickets are used, and indicates the expiration time of the ticket in seconds.</p>
            <h4>GnuTLSSessionTickets</h4>
            <div class="directive">
                <h5>Description:</h5>Enable Session Tickets for the server<br />
                <h5>Syntax:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                GnuTLSSessionTickets [ <i>on</i> | <i>off</i> ]<br />
                <h5>Default:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <i>off</i><br />
                <h5>Context:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                server config, virtual host<br />
            </div> 
            <p>To avoid storing data for TLS session resumption it is allowed to provide client with a ticket, to use on return.<br />
            Use for servers with limited storage, and don't combine with GnuTLSCache.<br />
            For a pool of servers this option is not recommended since the tickets are unique for the issuing server only.</p>
            <h4>GnuTLSCertificateFile</h4>
            <div class="directive">
                <h5>Description:</h5>Set to the PEM Encoded Server Certificate<br />
                <h5>Syntax:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                GnuTLSCertificateFile <i>file-path</i><br />
                <h5>Default:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <i>none</i><br />
                <h5>Context:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                server config, virtual host<br />
            </div>        
            <p>Takes an absolute or relative path to a PEM Encoded Certificate to use as this Server's Certificate.</p>
            <h4>GnuTLSKeyFile</h4>
            <div class="directive">
                <h5>Description:</h5>Set to the PEM Encoded Server Certificate<br />
                <h5>Syntax:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                GnuTLSCertificateFile <i>file-path</i><br />
                <h5>Default:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <i>none</i><br />
                <h5>Context:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                server config, virtual host<br />
            </div>  
            <p>Takes an absolute or relative path to the Server Private Key.<br />
            This key cannot currently be password protected.</p>
            <p class="warn">
                <b>Security Warning:</b><br />
                This private key must be protected. It is read while Apache is still running as root, and does not need to be readable by the nobody or apache user.
            </p>
            <h4>GnuTLSPGPCertificateFile</h4>
            <div class="directive">
                <h5>Description:</h5>Set to a base64 Encoded Server OpenPGP Certificate<br />
                <h5>Syntax:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                GnuTLSPGPCertificateFile <i>file-path</i><br />
                <h5>Default:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <i>none</i><br />
                <h5>Context:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                server config, virtual host<br />
            </div>
            <p>Takes an absolute or relative path to a base64 Encoded OpenPGP Certificate to use as this Server's Certificate.</p>
            <h4>GnuTLSPGPKeyFile</h4>
            <div class="directive">
                <h5>Description:</h5>Set to the Server OpenPGP Secret Key<br />
                <h5>Syntax:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                GnuTLSPGPKeyFile <i>file-path</i><br />
                <h5>Default:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <i>none</i><br />
                <h5>Context:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                server config, virtual host<br />
            </div>
            <p>Takes an absolute or relative path to the Server Private Key. This key cannot currently be password protected.</p>
            <p class="warn">
                <b>Security Warning:</b><br />
                This private key must be protected. It is read while Apache is still running as root, and does not need to be readable by the nobody or apache user.
            </p>            
            <h4>GnuTLSClientVerify</h4>
            <div class="directive">
                <h5>Description:</h5>Enable Client Certificate Verification<br />
                <h5>Syntax:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                GnuTLSClientVerify [ <i>ignore</i> | <i>request</i> | <i>require</i> ]<br />
                <h5>Default:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <i>ignore</i><br />
                <h5>Context:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                server config, virtual host, directory, .htaccess<br />
            </div>
            <p>This directive controls the use of SSL Client Certificate Authentication.<br />
            If used in the .htaccess context, it can force TLS re-negotiation.</p>
            <p>
                <b>ignore</b><br />
                mod_gnutls will ignore the contents of any SSL Client Certificates sent.<br />
                It will not request that the client sends a certificate.<br />
                <b>request</b><br />
                The client certificate will be requested, but not required.<br />
                The Certificate will be validated if sent.<br />
                The output of the validation status will be stored in the SSL_CLIENT_VERIFY environment variable and can be "SUCCESS", "FAILED" or "NONE".<br />
                <b>require</b><br />
                A Client certificate will be required. Any requests without a valid client certificate will be denied.<br />
                The SSL_CLIENT_VERIFY environment variable will only be set to "SUCCESS".
            </p>
            <h4>GnuTLSClientCAFile</h4>
            <div class="directive">
                <h5>Description:</h5>Set to the PEM Encoded Certificate Authority Certificate<br />
                <h5>Syntax:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                GnuTLSClientCAFile <i>file-path</i><br />
                <h5>Default:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <i>none</i><br />
                <h5>Context:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                server config, virtual host<br />
            </div>
            <p>
               Takes an absolute or relative path to a PEM Encoded Certificate to use as a Certificate Authority with Client Certificate Authentication.<br />
               This file may contain a list of trusted authorities.<br />
            </p>
            <h4>GnuTLSPGPKeyringFile</h4>
            <div class="directive">
                <h5>Description:</h5>Set to a base64 Encoded key ring<br />
                <h5>Syntax:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                GnuTLSPGPKeyringFile <i>file-path</i><br />
                <h5>Default:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <i>none</i><br />
                <h5>Context:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                server config, virtual host<br />
            </div>
            <p>Takes an absolute or relative path to a base64 Encoded Certificate list (key ring) to use as a means of verification of Client Certificates.<br />
               This file should contain a list of trusted signers.</p>
            <h4>GnuTLSEnable</h4>
            <div class="directive">
                <h5>Description:</h5>Enable GnuTLS for this virtual host<br />
                <h5>Syntax:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                GnuTLSEnable [ <i>on</i> | <i>off</i> ] <br />
                <h5>Default:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <i>off</i><br />
                <h5>Context:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                virtual host<br />
            </div>
            <p>This directive enables SSL/TLS Encryption for a Virtual Host.</p>
            <h4>GnuTLSDHFile</h4>
            <div class="directive">
                <h5>Description:</h5>Set to the PKCS #3 encoded Diffie Hellman parameters<br />
                <h5>Syntax:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                GnuTLSDHFile <i>file-path</i> <br />
                <h5>Default:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <i>none</i><br />
                <h5>Context:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                server config, virtual host<br />
            </div>
            <p>Takes an absolute or relative path to a PKCS #3 encoded DH parameters.<br />
            Those are used when the DHE key exchange method is enabled.<br />
            You can generate this file using "certtool --generate-dh-params --bits 2048".<br />
            If not set mod_gnutls will use the included parameters.</p>
            <h4>GnuTLSSRPPasswdFile</h4>
            <div class="directive">
                <h5>Description:</h5>Set to the SRP password file for SRP ciphersuites<br />
                <h5>Syntax:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                GnuTLSSRPPasswdFile <i>file-path</i> <br />
                <h5>Default:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <i>none</i><br />
                <h5>Context:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                server config, virtual host<br />
            </div>
            <p>Takes an absolute or relative path to an SRP password file.  This is the same format as used in libsrp.<br />
            You can generate such file using the command "srptool --passwd /etc/tpasswd --passwd-conf /etc/tpasswd.conf -u test" to set a password for user test.<br />
            This password file holds the username, a password verifier and the dependency to the SRP parameters.</p>
            <h4>GnuTLSSRPPasswdConfFile</h4>
            <div class="directive">
                <h5>Description:</h5>Set to the SRP password.conf file for SRP ciphersuites<br />
                <h5>Syntax:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                GnuTLSSRPPasswdConfFile <i>file-path</i> <br />
                <h5>Default:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <i>none</i><br />
                <h5>Context:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                server config, virtual host<br />
            </div>
            <p>Takes an absolute or relative path to an SRP password.conf file.  This is the same format as used in libsrp.<br />
            You can generate such file using the command "srptool --create-conf /etc/tpasswd.conf".<br />
            This file holds the SRP parameters and is associate with the password file (the verifiers depends on these parameters).</p>
            <h4>GnuTLSPriorities</h4>
            <div class="directive">
                <h5>Description:</h5>Set the allowed ciphers, key exchange algorithms, MACs and compression methods<br />
                <h5>Syntax:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                GnuTLSPriorities <i>+cipher0:+cipher1:...:+cipherN</i><br />
                <h5>Default:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <i>none</i><br />
                <h5>Context:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                server config, virtual host<br />
            </div>
            <p>
            Takes a semi-colon separated list of ciphers, key exchange methods<br />
            Message authentication codes and compression methods to enable.<br />
            The allowed keywords are specified in the gnutls_priority_init() function of GnuTLS.<br />
            It's documentation can be found at <a href="http://www.gnu.org/software/gnutls/manual/html_node/Core-functions.html#Core-functions">Core GnuTLS functions</a>.<br />
            In brief you can specify a set of ciphersuites from the choices:<br />
            <ul>
                <li><b>NONE</b>: The empty list.</li>
                <li><b>EXPORT</b>: A list with all the supported cipher combinations including the "EXPORT" strength algorithms.</li>
                <li><b>PERFORMANCE</b>: A list with all the secure cipher combinations sorted in terms of performance.</li>
                <li><b>NORMAL</b>: A list with all the secure cipher combinations sorted with respect to security margin (subjective term).</li>
                <li><b>SECURE</b>: A list with all the secure cipher combinations including the 256-bit ciphers sorted with respect to security margin.</li>
            </ul>
            </p>
            <p>
            Additionally you can add or remove algorithms using the "+" and "!" prefixes respectively.<br />
            That is in order to disable the ARCFOUR cipher from the "NORMAL" set you can use the string <b>NORMAL</b>:!ARCFOUR-128<br />
            Other options such as the protocol version and the compression method can be specified using the <b>VERS-</b> and <b>COMP-</b> prefixes.<br />
            So in order to remove or add a specific TLS version from the "NORMAL" set use <b>NORMAL:!VERS-SSL3.0</b>.<br />
            To enable zlib compression use <b>NORMAL:+COMP-DEFLATE</b>.<br />
            However it is recommended not to add compression at this level.<br />
            With the "NONE" set, in order to be usable, you have to specify a complete set of combinations of protocol versions,<br />
            cipher algorithms (<b>AES-128-CBC</b>), key exchange algorithms (<b>RSA</b>), message authentication codes (<b>SHA1</b>) and compression methods (<b>COMP-NULL</b>).<br />
            <br />
            All the supported algorithms are:<br />
            <ul>
                <li><b>Ciphers</b>: AES-256-CBC, AES-128-CBC, CAMELLIA-256-CBC, CAMELLIA-128-CBC, ARCFOUR-128, 3DES-CBC, ARCFOUR-40</li>
                <li><b>Key exchange methods</b>: RSA, DHE-RSA, DHE-DSS, SRP, SRP-RSA, SRP-DSS, ANON-DH</li>
                <li><b>Message authentication codes</b>: SHA1, MD5</li>
                <li><b>Compression methods</b>: COMP-DEFLATE, COMP-NULL</li>
                <li><b>Protocol versions</b>: VERS-TLS1.1, VERS-TLS1.0, VERS-SSL3.0</li>
            </ul>
            </p>
            <p>The special keyword "%COMPAT" will disable some security features such as protection against statistical attacks to ciphertext data in order to achieve maximum compatibility (some broken mobile clients need this).</p>
            <h4>GnuTLSExportCertificates</h4>
            <div class="directive">
                <h5>Description:</h5>Export the PEM encoded certificates to CGIs<br />
                <h5>Syntax:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                GnuTLSExportCertificates [ <i>on</i> | <i>off</i> ]<br />
                <h5>Default:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <i>off</i><br />
                <h5>Context:</h5>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                server config, virtual host<br />
            </div>
            <p>This directive enables exporting the full PEM encoded certificates of the server and the client to CGIs.<br />
            This makes mod_gnutls export exactly the same environment variables as mod_ssl.</p>
        </div>
        <hr />
        <div id="Examples">
            <h2>Configuration Examples</h2>
            <h4>Simple Standard SSL Example:</h4>
            <p>The following is an example of standard SSL Hosting, using one IP Addresses for each virtual host</p>
            <p>
            <code>
            # Load the module into Apache.<br />
            LoadModule gnutls_module modules/mod_gnutls.so<br />
            GnuTLSCache gdbm /var/cache/www-tls-cache<br />
            GnuTLSCacheTimeout 500<br />
            # With normal SSL Websites, you need one IP Address per-site.<br />
            Listen 1.2.3.1:443<br />
            Listen 1.2.3.2:443<br />
            Listen 1.2.3.3:443<br />
            Listen 1.2.3.4:443<br />
            &lt;VirtualHost 1.2.3.1:443&gt;<br />
            GnuTLSEnable on<br />
            GnuTLSPriorities NONE:+AES-128-CBC:+3DES-CBC:+ARCFOUR-128:+RSA:+DHE-RSA:+DHE-DSS:+SHA1:+MD5:+COMP-NULL<br />
            DocumentRoot /www/site1.example.com/html<br />
            ServerName site1.example.com:443<br />
            GnuTLSCertificateFile conf/ssl/site1.crt<br />
            GnuTLSKeyFile conf/ss/site1.key<br />
            &lt;/VirtualHost&gt;<br />
            &lt;VirtualHost 1.2.3.2:443&gt;<br />
            # This virtual host enables SRP authentication<br />
            GnuTLSEnable on<br />
            GnuTLSPriorities NORMAL:+SRP<br />
            DocumentRoot /www/site2.example.com/html<br />
            ServerName site2.example.com:443<br />
            GnuTLSSRPPasswdFile conf/ssl/tpasswd.site2<br />
            GnuTLSSRPPasswdConfFile conf/ssl/tpasswd.site2.conf<br />
            &lt;/VirtualHost&gt;<br />
            &lt;VirtualHost 1.2.3.3:443&gt;<br />
            # This server enables SRP, OpenPGP and X.509 authentication.<br />
            GnuTLSEnable on<br />
            GnuTLSPriorities NORMAL:+SRP:+SRP-RSA:+SRP-DSS<br />
            DocumentRoot /www/site3.example.com/html<br />
            ServerName site3.example.com:443<br />
            GnuTLSCertificateFile conf/ssl/site3.crt<br />
            GnuTLSKeyFile conf/ss/site3.key<br />
            GnuTLSClientVerify ignore<br />
            GnuTLSPGPCertificateFile conf/ss/site3.pub.asc<br />
            GnuTLSPGPKeyFile conf/ss/site3.sec.asc<br />
            GnuTLSSRPPasswdFile conf/ssl/tpasswd.site3<br />
            GnuTLSSRPPasswdConfFile conf/ssl/tpasswd.site3.conf<br />
            &lt;/VirtualHost&gt;<br />
            &lt;VirtualHost 1.2.3.4:443&gt;<br />
            GnuTLSEnable on<br />
            # %COMPAT disables some security features to enable maximum compatibility with clients.<br />
            GnuTLSPriorities NONE:+AES-128-CBC:+ARCFOUR-128:+RSA:+SHA1:+MD5:+COMP-NULL:%COMPAT<br />
            DocumentRoot /www/site4.example.com/html<br />
            ServerName site4.example.com:443<br />
            GnuTLSCertificateFile conf/ssl/site4.crt<br />
            GnuTLSKeyFile conf/ss/site4.key<br />
            &lt;/VirtualHost&gt;<br />
            </code>
            </p>
            <h4>Server Name Indication Example:</h4>
            <p>
            mod_gnutls can also use 'Server Name Indication', as specified in RFC 3546.<br />
            This allows hosting many SSL Websites, with a Single IP Address.<br />
            Currently all the recent browsers support this standard.<br />
            Here is an example, using SNI:<br />
            <code>
            <p>
            # Load the module into Apache.<br />
            LoadModule gnutls_module modules/mod_gnutls.so<br />
            # With normal SSL Websites, you need one IP Address per-site.<br />
            Listen 1.2.3.1:443<br />
            # This could also be 'Listen *:443',<br />
            # just like '*:80' is common for non-https<br />
            # No caching. Enable session tickets. Timeout is still used for<br />
            # ticket expiration.<br />
            GnuTLSCacheTimeout 600<br />
            # This tells apache, that for this IP/Port combination, we want to use<br />
            # Name Based Virtual Hosting. In the case of Server Name Indication,<br />
            # it lets mod_gnutls pick the correct Server Certificate.<br />
            NameVirtualHost 1.2.3.1:443<br />
            &lt;VirtualHost 1.2.3.1:443&gt;<br />
            GnuTLSEnable on<br />
            GnuTLSSessionTickets on<br />
            GnuTLSPriorities NORMAL<br />
            DocumentRoot /www/site1.example.com/html<br />
            ServerName site1.example.com:443<br />
            GnuTLSCertificateFile conf/ssl/site1.crt<br />
            GnuTLSKeyFile conf/ss/site1.key<br />
            &lt;/VirtualHost&gt;<br />
            &lt;VirtualHost 1.2.3.1:443&gt;<br />
            GnuTLSEnable on<br />
            GnuTLSPriorities NORMAL<br />
            DocumentRoot /www/site2.example.com/html<br />
            ServerName site2.example.com:443<br />
            GnuTLSCertificateFile conf/ssl/site2.crt<br />
            GnuTLSKeyFile conf/ss/site2.key<br />
            &lt;/VirtualHost&gt;<br />
            &lt;VirtualHost 1.2.3.1:443&gt;<br />
            GnuTLSEnable on<br />
            GnuTLSPriorities NORMAL<br />
            DocumentRoot /www/site3.example.com/html<br />
            ServerName site3.example.com:443<br />
            GnuTLSCertificateFile conf/ssl/site3.crt<br />
            GnuTLSKeyFile conf/ss/site3.key<br />
            &lt;/VirtualHost&gt;<br />
            &lt;VirtualHost 1.2.3.1:443&gt;<br />
            GnuTLSEnable on<br />
            GnuTLSPriorities NORMAL<br />
            DocumentRoot /www/site4.example.com/html<br />
            ServerName site4.example.com:443<br />
            GnuTLSCertificateFile conf/ssl/site4.crt<br />
            GnuTLSKeyFile conf/ss/site4.key<br />
            &lt;/VirtualHost&gt;<br />
            </p>
            </code>
            </p>
        </div>
        <hr />
        <div id="Performance">
            <h2>Performance Issues:</h2>
            <p>
            mod_gnutls by default uses conservative settings for the server.<br />
            You can fine tune the configuration to reduce the load on a busy server.<br />
            The following examples do exactly this:<br />
            <code>
            # Load the module into Apache.<br />
            LoadModule gnutls_module modules/mod_gnutls.so<br />
            # Using 4 memcache servers to distribute the SSL Session Cache.<br />
            GnuTLSCache memcache "mc1.example.com mc2.example.com mc3.example.com mc4.example.com"<br />
            GnuTLSCacheTimeout 600<br />
            Listen 1.2.3.1:443<br />
            NameVirtualHost 1.2.3.1:443<br />
            &lt;VirtualHost 1.2.3.1:443&gt;<br />
            GnuTLSEnable on<br />
            # Here we disable the Perfect forward secrecy ciphersuites (DHE)<br />
            # and disallow AES-256 since AES-128 is just fine.<br />
            GnuTLSPriorities NORMAL:!DHE-RSA:!DHE-DSS:!AES-256-CBC:%COMPAT<br />
            DocumentRoot /www/site1.example.com/html<br />
            ServerName site1.example.com:443<br />
            GnuTLSCertificateFile conf/ssl/site1.crt<br />
            GnuTLSKeyFile conf/ss/site1.key<br />
            &lt;/VirtualHost&gt;<br />
            &lt;VirtualHost 1.2.3.1:443&gt;<br />
            GnuTLSEnable on<br />
            # Here we instead of disabling the DHE ciphersuites we use<br />
            # Diffie Hellman parameters of smaller size than the default (2048 bits).<br />
            # Using small numbers from 768 to 1024 bits should be ok once they are<br />
            # regenerated every few hours.<br />
            # Use "certtool --generate-dh-params --bits 1024" to get those<br />
            GnuTLSDHFile /etc/apache2/dh.params<br />
            GnuTLSPriorities NORMAL:!AES-256-CBC:%COMPAT<br />
            DocumentRoot /www/site2.example.com/html<br />
            ServerName site2.example.com:443<br />
            GnuTLSCertificateFile conf/ssl/site2.crt<br />
            GnuTLSKeyFile conf/ss/site2.key<br />
            &lt;/VirtualHost&gt;<br />
            </code>
            </p>
        </div>
        <hr />
        <div id="EnvironmentVars">
            <h2>Environment Variables:</h2>
            <p>mod_gnutls exports the following environment variables to scripts.<br />
            These are compatible with mod_ssl.</p>
            <h6>HTTPS</h6>
            <p>Can be "on" or "off"</p>
            <h6>SSL_VERSION_LIBRARY</h6>
            <p>The version of the gnutls library</p>
            <h6>SSL_VERSION_INTERFACE</h6>
            <p>The version of this module</p>
            <h6>SSL_PROTOCOL</h6>
            <p>The SSL or TLS protocol name (such as "TLS 1.0" etc.)</p>
            <h6>SSL_CIPHER</h6>
            <p>The SSL or TLS cipher suite name</p>
            <h6>SSL_COMPRESS_METHOD</h6>
            <p>The negotiated compression method (NULL or DEFLATE)</p>
            <h6>SSL_SRP_USER</h6>
            <p>The SRP username used for authentication.</p>
            <h6>SSL_CIPHER_USEKEYSIZE &amp; SSL_CIPHER_ALGKEYSIZE</h6>
            <p>The number if bits used in the used cipher algorithm.</p>
            <p>This does not fully reflect the security level since the size of</p>
            <p>RSA or DHE key exchange parameters affect the security level too.</p>
            <h6>SSL_CIPHER_EXPORT</h6>
            <p>True or False. Whether the cipher suite negotiated is an export one.</p>
            <h6>SSL_SESSION_ID</h6>
            <p>The session ID negotiated in this session. Can be the same during client reloads.</p>
            <h6>SSL_CLIENT_V_REMAIN</h6>
            <p>The number of days until the client's certificate is expired.</p>
            <h6>SSL_CLIENT_V_START</h6>
            <p>The activation time of client's certificate.</p>
            <h6>SSL_CLIENT_V_END</h6>
            <p>The expiration time of client's certificate.</p>
            <h6>SSL_CLIENT_S_DN</h6>
            <p>The distinguished name of client's certificate in RFC2253 format.</p>
            <h6>SSL_CLIENT_I_DN</h6>
            <p>The SSL or TLS cipher suite name</p>
            <h6>SSL_CLIENT_S_AN%</h6>
            <p>These will contain the alternative names of the client certificate (% is a number starting from zero).</p>
            <p>The values will be prepended by "DNSNAME:", "RFC822NAME:" or "URI:" depending on the type.</p>
            <p>If it is not supported the value "UNSUPPORTED" will be set.</p>
            <h6>SSL_SERVER_M_SERIAL</h6>
            <p>The serial number of the server's certificate.</p>
            <h6>SSL_SERVER_M_VERSION</h6>
            <p>The version of the server's certificate.</p>
            <h6>SSL_SERVER_A_SIG</h6>
            <p>The algorithm used for the signature in server's certificate.</p>
            <h6>SSL_SERVER_A_KEY</h6>
            <p>The public key algorithm in server's certificate.</p>
            <h6>SSL_SERVER_CERT</h6>
            <p>The PEM-encoded server certificate.</p>
            <h6>SSL_SERVER_CERT_TYPE</h6>
            <p>The certificate type can be X.509 or OPENPGP.</p>
        </div>
    </body>
</html>
